import java.io.IOException;
import java.util.LinkedList;
import java.util.Random;

class Model
{
	// Sprite stuff!
	LinkedList<Sprite> sprite_list;
	int add_tube_count = 0;
	
	// Other
	Random rng;

	Model() throws IOException {
		// Initialize sprite_list and the random num generator
		this.sprite_list = new LinkedList<Sprite>();
		this.rng = new Random();
		
		// Add a bird into the sprite list!
		// It's the first thing added, so index 0
		sprite_list.add(new Bird(300,100,sprite_list));
	}

	public void update() throws IOException {
		// Call update() for bird and tubes!
		for (Sprite current_sprite : sprite_list) {
			if (!current_sprite.is_dead) current_sprite.update();
		}

		// Add another tube to the screen after 60 frames
		add_tube_count++;
		
		if (add_tube_count == 60) {
			sprite_list.add(new Tube(500, RNG(100,300), RNG(0,1)));
			add_tube_count = 0;
		}
		
		// Delete tubes that go off-screen
		for (Sprite current_sprite : sprite_list) {
			if (current_sprite.is_dead) {
				if (sprite_list.remove(current_sprite)) break;
			}
		}
		
		// Game the game over
	}
	
	public void onClick() throws IOException {
		// Make all the birds (just one bird right now hehe) flap 
		for (Sprite current_sprite : sprite_list) {
			if (current_sprite.getClass().equals(Bird.class)) {
				Bird current_bird = (Bird)current_sprite;
				current_bird.flap();
			}
		}
	}
	
	// Returns an int in range [from, to]
	public int RNG(int from, int to) {
		return rng.nextInt(to - from + 1) + from;
	}
	
	public void game_over() {
		System.out.println("Game over!");
		for (Sprite current_sprite : sprite_list) current_sprite.game_over();
	}
}
