import java.io.File;
import java.io.IOException;
import java.util.LinkedList;
import java.util.Random;

import javax.imageio.ImageIO;

class Model
{
	// Bird stuff
	Bird pigeon;
	
	// Tube stuff
	LinkedList<Sprite> sprite_list;
	int add_tube_count = 0;
	
	// Other
	Random rng;
	boolean collision = false;

	Model() throws IOException {
		Bird b = new Bird(300,100);
		this.pigeon = b;
		this.sprite_list = new LinkedList<Sprite>();
		this.rng = new Random();
	}

	public void update() throws IOException {
		// Call update() for bird and tubes!
		pigeon.update();
		
		for (Sprite current_sprite : sprite_list) {
			if (!current_sprite.is_dead) current_sprite.update();
		}
		
		// Check whether bird hits tube
		//collisionDetection();
		//if (collision) gameOver();

		// Add another tube to the screen after 60 frames
		add_tube_count++;
		
		if (add_tube_count == 60) {
			sprite_list.add(new Tube(500, RNG(100,300), RNG(0,1)));
			add_tube_count = 0;
		}
		
		// Delete tubes that go off-screen
		for (Tube current_sprite : sprite_list) {
			if (current_sprite.is_dead) {
				if (sprite_list.remove(current_sprite)) break;
			}
		}
	}
	
	public void onClick() throws IOException {
		pigeon.flap();
	}
	
	// Returns an int in range [from, to]
	public int RNG(int from, int to) {
		return rng.nextInt(to - from + 1) + from;
	}
	
	public void game_over() {
		System.out.println("Game over!");
		for (Sprite current_sprite : sprite_list) current_sprite.game_over();
	}
}
